<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<title>Parlin to Vadodara | R & F üíñ</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{height:100%;font-family:'Georgia',serif;background:#050714;color:#fff;overflow:hidden; scroll-behavior: smooth;}
    .stars{position:fixed;inset:0;background:radial-gradient(1px 1px at 10% 20%,#fff,transparent),radial-gradient(2px 2px at 40% 50%,#fff,transparent);background-size:200% 200%;animation:drift 100s linear infinite;z-index:-1;}
    @keyframes drift{from{background-position:0 0} to{background-position:200% 200%;}}

    /* SLOW CURSOR TRAIL */
    .trail { position: fixed; pointer-events: none; font-size: 26px; z-index: 9999; animation: floatUp 2.5s forwards; }
    @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-80px) scale(2); } }

    /* PASSPORT SIDEBAR */
    #passport-container {
        position: fixed; left: 15px; top: 50%; transform: translateY(-50%); width: 55px;
        background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid #ff69b4;
        border-radius: 30px; display: flex; flex-direction: column; align-items: center; padding: 15px 0;
        z-index: 2500; transition: width 0.3s; overflow: hidden;
    }
    #passport-container:hover { width: 180px; }
    .passport-label { font-size: 0.6rem; color: #ff69b4; margin-bottom: 10px; opacity: 0; white-space: nowrap; font-weight: bold; }
    #passport-container:hover .passport-label { opacity: 1; }
    .stamp { width: 38px; height: 38px; margin: 8px 0; border-radius: 50%; border: 2px dashed rgba(255, 105, 180, 0.2);
        display: flex; align-items: center; justify-content: center; font-size: 1.1rem; filter: grayscale(1) opacity(0.2); transition: all 0.5s; }
    .stamp.unlocked { filter: grayscale(0) opacity(1); border: 2px solid #ff69b4; transform: rotate(-15deg); background: rgba(255, 105, 180, 0.1); }

    /* INTERFACE */
    .meter-container { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); width: 250px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; border: 1px solid #ff69b4; z-index: 2000; }
    .meter-fill { width: 0%; height: 100%; background: #ff69b4; border-radius: 10px; transition: 1.2s; box-shadow: 0 0 10px #ff69b4; }
    .clock-container { position: fixed; bottom: 15px; right: 15px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 10px; border-radius: 12px; border: 1px solid #ff69b4; z-index: 2000; font-size: 0.7rem; text-align: right; line-height: 1.4; }

    .reel{height:100vh; overflow-y: hidden; scroll-snap-type: y mandatory;}
    .frame{height:100vh; scroll-snap-align:start; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:30px; text-align:center; position:relative;}
    .text{max-width:800px; font-size:2rem; line-height:1.5; margin-bottom:20px; text-shadow: 0 0 10px #ff69b4;}

    /* MAP & FLIGHT */
    /*
    .map-svg { width: 100%; max-width: 700px; height: auto; overflow: visible; }
    .path-dotted { stroke: rgba(255,105,180,0.4); stroke-width: 2; fill: none; stroke-dasharray: 8; }
    #plane-icon { font-size: 24px; offset-path: path("M100,200 C150,50 550,50 700,250"); offset-rotate: auto; position: absolute; display: none; z-index: 10; }
*/
    /* GAME UI */
    .box{background:rgba(255,255,255,0.08); backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,0.2); padding:25px; border-radius:20px; width:100%; max-width:450px;}
    .btn-opt{display:block; width:100%; padding:12px; margin:8px 0; background:transparent; border:1px solid #ff69b4; color:#fff; border-radius:30px; cursor:pointer; font-family: inherit; transition: 0.3s;}
    .btn-opt:hover{background: rgba(255,105,180,0.3);}
    
    .scratch-gallery { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;}
    .scratch-card { position: relative; width: 130px; height: 130px; border: 1px solid #ff69b4; border-radius: 10px; overflow: hidden; background: #1a2147; }
    .scratch-canvas { position: absolute; top: 0; left: 0; z-index: 2; cursor: crosshair; touch-action: none; }
    .scratch-reveal { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #ff69b4; padding: 5px; z-index: 1; text-align: center; font-weight: bold;}

    .ttt-grid{display:grid; grid-template-columns:repeat(3, 75px); gap:8px; margin-top:15px;}
    .cell{width:75px; height:75px; background:rgba(255,255,255,0.1); border:1px solid #ff69b4; display:flex; align-items:center; justify-content:center; font-size:2rem; cursor:pointer; border-radius: 8px;}

    @keyframes heartGlow {
    0% {
        filter: drop-shadow(0 0 8px rgba(255,105,180,0.6));
    }
    50% {
        filter: drop-shadow(0 0 22px rgba(255,105,180,1));
    }
    100% {
        filter: drop-shadow(0 0 8px rgba(255,105,180,0.6));
    }
}

@keyframes heartPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.04); }
    100% { transform: scale(1); }
}

.heart-glow {
    animation: heartGlow 2.5s ease-in-out infinite;
}

.heart-pulse {
    animation: heartPulse 3s ease-in-out infinite;
}
    
    /* HEART PATH */
    .path-line{ stroke:#ff69b4; stroke-width:3; fill: rgba(255, 105, 180, 0); filter:drop-shadow(0 0 10px #ff69b4); opacity:0; transition: opacity 2s, fill 2s; }
    .step{position:absolute; width:26px; height:26px; background:#ff69b4; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:10px; z-index: 5;}
    #heartInitials { position:absolute; font-size:3rem; color:#ff69b4; top:50%; left:50%; transform:translate(-50%,-50%); opacity:0; font-weight:bold; transition: opacity 2s; z-index: 10; }

    /* PHOTO MODAL IMG */
    .photo-modal-img { width: 100%; max-width: 300px; border-radius: 10px; border: 3px solid #ff69b4; margin-bottom: 15px; }

    /* GIFT */
    .gift-container { position: relative; width: 150px; height: 150px; cursor: pointer; }
    .gift-box { width: 100%; height: 100%; background: #ff69b4; border-radius: 8px; position: relative; transition: 0.5s; z-index: 2;}
    .gift-lid { width: 110%; height: 30px; background: #ff1493; position: absolute; top: -10px; left: -5%; border-radius: 4px; transition: 0.8s; z-index: 3;}
    .unwrapped .gift-lid { transform: translateY(-100px) rotate(20deg); opacity: 0; }
    .unwrapped .gift-box { transform: scale(0); opacity: 0; }
    .reveal-gift { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: #fff; color: #000; border-radius: 8px; opacity: 0; transform: scale(0.5); transition: 1s; z-index: 1; padding: 10px; text-align: center; font-weight: bold;}
    .unwrapped .reveal-gift { opacity: 1; transform: scale(1.3); z-index: 4; }

    .modal{position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:4000;}

    /* THE END SCREEN */
    #end-screen {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle, #0b1023 0%, #050714 100%);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 5000;
        text-align: center;
        opacity: 0;
        transition: opacity 2s;
    }

    #heartInitialsWrapper {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    pointer-events: none;
    }

    #heartInitials {
    font-size: 3rem;
    color: #ff69b4;
    font-weight: bold;
    opacity: 0;
    transition: opacity 2s;
    white-space: nowrap; /* Keeps R & F on one line */
    text-shadow: 0 0 20px #ff69b4;
    text-align: center;
    margin: 0; 
    line-height: 1; /* Prevents vertical offset */
    }

    #sky-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Great Vibes', cursive; /* Elegant cursive */
    font-size: 6rem; /* Large enough to cover half the page */
    color: #ff69b4;
    text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 0 0 40px rgba(255, 105, 180, 0.4);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 2s ease-in-out;
    pointer-events: none;
    z-index: 5;
}

/* PUZZLE STYLES */
.pieces-bin {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    min-height: 100px;
    width: 100%;
    max-width: 400px;
}

/* PUZZLE STYLES UPDATED */

/* PUZZLE CONTAINER UPDATED */
.puzzle-container {
    display: grid;
    grid-template-columns: repeat(3, 80px);
    grid-template-rows: repeat(3, 80px);
    gap: 5px;
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    border: 2px solid #ff69b4;
    border-radius: 10px;
    margin-bottom: 20px;
    position: relative;
    /* transition: gap, padding, and transform for the expansion effect */
    transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
}

/* Expansion state */
.puzzle-container.completed {
    gap: 0;
    padding: 0;
    border: 4px solid #fff;
    transform: scale(1.2); /* Expands the photo to be 20% larger */
    box-shadow: 0 0 30px rgba(255, 105, 180, 0.8); /* Adds a glowing aura */
    z-index: 2000; /* Ensures it sits above other elements */
}

.puzzle-slot {
    width: 80px;
    height: 80px;
    border: 1px dashed rgba(255, 105, 180, 0.3);
    transition: border 0.5s;
}

.puzzle-container.completed .puzzle-slot {
    border: none;
}

.puzzle-piece {
    width: 80px;
    height: 80px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-size: 240px 240px;
    position: absolute;
    transition: border 0.5s;
}

.puzzle-container.completed .puzzle-piece {
    border: none;
}

@keyframes paperDrop {
    0% {
        opacity: 0;
        transform: translateY(-120px);
    }
    70% {
        transform: translateY(15px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Initial hidden state */
.sticky {
    opacity: 0;
}

/* Animate only when activated */
.sticky.drop {
    animation: paperDrop 0.8s ease-out forwards;
}

.sticky-note {
    width: 180px;
    min-height: 180px;
    padding: 15px;
    background: #fff8a6;
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    border-radius: 10px;
    font-family: 'Comic Sans MS';
    word-wrap: break-word;
    animation: paperDrop 0.8s ease-out forwards;
    opacity: 0; /* start hidden */

    aspect-ratio: 1/1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    font-size: 1.2rem;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
    transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    text-align: center;
    border-radius: 2px;
}

.sticky-note.revealed {
    transform: rotate(0deg) scale(1.05);
    font-family: 'Courier New', Courier, monospace, cursive;
    font-size: fit;
    background: #fff !important;
    color: #080fe3 !important;
}


#heartInitials.heart-pulse {
    text-shadow: 0 0 20px #ff69b4, 0 0 40px rgba(255,105,180,0.6);
}


.mini-note {
    aspect-ratio: 1 / 1;
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-family: 'Great Vibes', cursive;
    font-size: 1.1rem;
    border-radius: 5px;
    box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    line-height: 1.3;
}

.mini-note:hover {
    transform: scale(1.05) rotate(2deg);
}

.mini-note.popped {
    transform: scale(0.9) rotate(-2deg);
    opacity: 0.8;
}

.fan-container {
    position: relative;
    width: 200px;
    height: 250px;
    margin: 40px auto;
}

.fan-card {
    position: absolute;
    width: 200px;
    height: 200px;
    background: var(--bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-family: 'Great Vibes', cursive;
    font-size: 1.2rem;
    transition: transform 0.5s ease, z-index 0s;
    /* Spreads them out slightly by default */
    transform: rotate(calc(var(--i) * 5deg - 5deg)); 
    cursor: pointer;
}

/* When the container is hovered or tapped, the cards "fan out" */
.fan-container:hover .fan-card {
    transform: rotate(calc(var(--i) * 20deg - 20deg)) translateX(calc(var(--i) * 30px - 30px));
}

.fan-card:hover {
    z-index: 50;
    transform: scale(1.1) translateY(-20px) !important;
}

#emojiOptions .btn-opt {
    font-size: 0.9rem;
    text-transform: none;
    border-style: dashed;
}
#emojiOptions .btn-opt:active {
    background: #ff69b4;
    transform: scale(0.95);
}

</style>
</head>

<body>

    <audio id="bgm" loop preload="auto">
    <source src="https://github.com/ruddy220497/Birthday/raw/refs/heads/main/song.mp3" type="audio/mpeg">
</audio>

<div class="stars"></div>
<audio id="bgm" loop><source src="bollywood-love.mp3" type="audio/mpeg"></audio>

<div id="passport-container">
    <div class="passport-label">${n()}!'S TRAVELS</div>
    <div id="stamp-0" class="stamp unlocked" title="Departure">üõ´</div>
    <div id="stamp-1" class="stamp" title="Check-in">üíñ</div>
    <div id="stamp-2" class="stamp" title="Flight">‚úàÔ∏è</div>
    <div id="stamp-3" class="stamp" title="Quiz Master">üß†</div>
    <div id="stamp-4" class="stamp" title="Secret Seeker">üíå</div>
    <div id="stamp-5" class="stamp" title="XOXO Winner">‚≠ï</div>
    <div id="stamp-6" class="stamp" title="Love Note">üìú</div>
    <div id="stamp-7" class="stamp" title="Sentence">üí≠</div>
    <div id="stamp-8" class="stamp" title="Shrinker">üåç</div>
    <div id="stamp-9" class="stamp" title="Flag Match">üíö</div>
    <div id="stamp-10" class="stamp" title="Decoder">ü´Ç</div>
    <div id="stamp-11" class="stamp" title="Planner">üçú</div>
    <div id="stamp-12" class="stamp" title="Quiet Moment">üåô</div>
    <div id="stamp-13" class="stamp" title="Heart Path">üêò</div>
    <div id="stamp-14" class="stamp" title="Arrival">üèÅ</div>
</div>

<div class="clock-container">
    <div style="color:#ff69b4; font-weight:bold; margin-bottom:4px;">Parlin ‚úàÔ∏è Vadodara</div>
    <div>Parlin (EST): <span id="myTime">00:00</span></div>
    <div>Vadodara (IST): <span id="herTime">00:00</span></div>
</div>

<div class="reel" id="reel">
    <section class="frame"><div class="text" id="typewriter"></div><button class="btn-opt" style="width:180px" onclick="startQuest()">Enter the Quest</button></section>

    <section class="frame">
        <div class="text">Before we begin‚Ä¶</div>
        <div class="box">
            <p style="margin-bottom:15px">What should I call you?</p>
            <input id="nameInput" type="text" placeholder="Your name üíñ" style="width:100%; padding:12px; border-radius:30px; border:1px solid #ff69b4; background:transparent; color:#fff; text-align:center; font-family:inherit; outline:none;" />
            <button class="btn-opt" style="margin-top:20px" onclick="saveName()">Continue</button>
        </div>
    </section>


<section class="frame">
    <div class="text">Flight: <span style="color:#ff69b4; font-family:'Georgia';">Frooti o'clock</span> üéÄüíé</div>
    
    <div id="flight-game-area" style="position: relative; width: 100%; max-width: 600px; height: 350px; margin: 0 auto; background: rgba(255,255,255,0.05); border-radius: 20px; border: 1px solid #ff69b4; display: flex; align-items: center; justify-content: center; overflow: hidden;">
        
        <div id="flight-assets" style="width: 100%; height: 100%; position: relative;">
            <div style="position: absolute; left: 10%; top: 50%; transform: translateY(-50%); text-align: center;">
                <div style="font-size: 3rem;">üá∫üá∏</div>
                <div style="font-size: 0.8rem; color: #ff69b4; font-weight: bold;">Parlin, USA</div>
            </div>

            <div style="position: absolute; right: 10%; top: 50%; transform: translateY(-50%); text-align: center;">
                <div style="font-size: 3rem;">üáÆüá≥</div>
                <div style="font-size: 0.8rem; color: #ff69b4; font-weight: bold;">Vadodara, India</div>
            </div>

            <svg style="position: absolute; inset: 0; pointer-events: none;">
                <path id="flight-path" d="M100,175 C150,75 450,75 500,175" fill="none" stroke="transparent" />
            </svg>

            <div id="interactive-plane" style="position: absolute; font-size: 35px; offset-path: path('M100,175 C150,75 450,75 500,175'); offset-rotate: auto; top:0; left:0;">‚úàÔ∏è</div>
        </div>

        <div id="arrival-photo" style="display: none; opacity: 0; transition: 1.5s; z-index: 25; width: 100%; height: 100%;">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%;">
        
        <img src="https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/Flight%20Photo.jpg" style="max-width: 80%; max-height: 60%; border-radius: 15px; border: 3px solid #ff69b4; box-shadow: 0 0 30px rgba(255, 105, 184, 0.7); object-fit: contain;">
        
        <div style="font-family: 'Great Vibes', cursive; font-size: 3.0rem; color: #ff69b4; margin-top: 20px; text-shadow: 0 0 15px rgba(255, 105, 184, 0.8); white-space: nowrap;">
            Can't wait to move from virtual to real ü§≠
        </div>
        
    </div>
</div>
    </div>

    <div id="flight-status" style="margin: 20px 0; color: #ff69b4; font-weight: bold;">Press to start the journey! üõ´</div>
    <button id="boost-btn" class="btn-opt" style="width: 240px;" onclick="boostPlane()">Tap to Power the airplane üöÄ</button>
</section>


<section class="frame" id="reasonsFrame" style="background: #1a1a2e; padding: 40px 10px;">
    <div class="text" style="font-size: 1.8rem; margin-bottom: 30px;">Things I love about you ‚úçÔ∏è</div>
    
    <div id="sticky-wall" style="display: flex;flex-wrap: wrap;justify-content: center; gap: 15px; max-width: fit-content; margin: 0 auto;">
        <div class="sticky-note" onclick="revealNote(this, 'Your Kind & Pure Soul! ‚ù£Ô∏è')" style="background: #ff7eb9; transform: rotate(-2deg);">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'The way you make me smile! ‚ù£Ô∏è')" style="background: #ffea00; transform: rotate(3deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'How honest you are! ‚ù£Ô∏è')" style="background: #7afcff; transform: rotate(-1deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'Your contagious laugh! ‚ù£Ô∏è')" style="background: #a9ff68; transform: rotate(2deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'How incredibly you care about me! ‚ù£Ô∏è')" style="background: #8668ff; transform: rotate(-2deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'How unconditionally you trust me! ‚ù£Ô∏è')" style="background: #c805bb; transform: rotate(3deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'The way you look at me! ‚ù£Ô∏è')" style="background: #08d4df; transform: rotate(-1deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'The way you demand to be pampered! ‚ù£Ô∏è')" style="background: hsl(0, 1%, 47%); transform: rotate(2deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'You are beautiful inside out! ‚ù£Ô∏è')" style="background: #d03010; transform: rotate(-2deg); color: #333;">?</div>
        <div class="sticky-note" onclick="revealNote(this, 'The list is endless, for now let us move to the next section! ‚ù£Ô∏è')" style="background: hsl(298, 97%, 47%); transform: rotate(3deg); color: #333;">?</div>
    </div>

    <button id="reasonsNextBtn" class="btn-opt" style="display:none; margin-top: 30px; width: 200px;" onclick="unlockNext()">Continue Journey</button>
</section>


    <section class="frame">
        <div class="text">The Memory Quiz üß†</div>
        <div class="box" id="quizBox">
            <p id="qText" style="margin-bottom:15px;"></p>
            <div id="quizOptions"></div>
        </div>
    </section>

    <section class="frame" id="moonFrame" style="background: linear-gradient(to bottom, #020107 0%, #201b46 100%);">
    <div class="text">Two different times, one shared heart. üåô</div>
    
    <div style="display: flex; justify-content: space-around; align-items: center; width: 100%; max-width: 500px; margin: 30px auto;">
        <div style="text-align: center;">
            <div style="font-size: 0.8rem; color: #ff69b4; margin-bottom: 10px;">Parlin</div>
            <div style="font-size: 3.5rem; filter: drop-shadow(0 0 15px #fff);">üåô</div>
        </div>

        <div style="flex-grow: 1; height: 2px; background: linear-gradient(to right, transparent, #ff69b4, transparent); margin: 0 20px; position: relative;">
            <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 1.2rem;">‚úàÔ∏è</div>
        </div>

        <div style="text-align: center;">
            <div style="font-size: 0.8rem; color: #ffea00; margin-bottom: 10px;">Vadodara</div>
            <div style="font-size: 3.5rem; filter: drop-shadow(0 0 15px #ffea00);">‚òÄÔ∏è</div>
        </div>
    </div>

    <div class="box" style="border: none; background: rgba(255,255,255,0.05); padding: 25px;">
        <p style="font-style: italic; font-size: 1.1rem; line-height: 1.6;">
            "While I'm falling asleep under the stars in Parlin, you're just starting your day in Vadodara. It‚Äôs a long way for a heart to travel, but mine makes the trip every single second. My 'Goodnight' is your 'Good Morning,' and somehow, we make those two worlds meet in the middle every single day."
        </p>
    </div>

    <button class="btn-opt" style="margin-top: 30px; width: 220px;" onclick="unlockNext()">Across the Miles ‚ù§Ô∏è</button>
</section>


<section class="frame">
    <div class="text">Send your heartbeat to Rudu... üíì</div>
    
    <div style="position: relative; height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        
        <div id="tap-heart" onclick="pulseHeart()" style="font-size: 6rem; cursor: pointer; transition: 0.2s; filter: drop-shadow(0 0 10px rgba(255,105,184,0.3));">‚ù§Ô∏è</div>
        
        <div id="tap-status" style="margin-top: 30px; color: #ff69b4; font-weight: bold; font-family: monospace;">BEATS SENT: 0/10</div>
        
        <p id="tap-message" style="margin-top: 15px; font-style: italic; max-width: 280px; text-align: center; opacity: 0; transition: 1s;"></p>
    </div>

    <button id="tapNextBtn" class="btn-opt" style="display:none; margin-top: 20px;" onclick="unlockNext()">Connection Established</button>
</section>

    <section class="frame">
        <div class="text">Scratch, scratch all the way üíå</div>
        <div class="scratch-gallery">
            <div class="scratch-card"><div class="scratch-reveal">Warning: Hug debt Accumulating ü´Ç</div><canvas class="scratch-canvas" width="130" height="130"></canvas></div>
            <div class="scratch-card"><div class="scratch-reveal">Teleportation still pending ü•∫</div><canvas class="scratch-canvas" width="130" height="130"></canvas></div>
            <div class="scratch-card"><div class="scratch-reveal">Next birthday‚Ä¶no distance! ‚ù§Ô∏è</div><canvas class="scratch-canvas" width="130" height="130"></canvas></div>
        </div>
        <button id="scratch-unlock-btn" class="btn-opt" style="width:200px; display:none;" onclick="updateMeter(55); reveal(`Let's play something now`, true)">Continue Journey</button>
        <p id="scratch-hint" style="margin-top:15px; opacity:0.6;">Scratch deeply to reveal the messages!</p>
    </section>

    <section class="frame">
        <div class="text">XOXO Challenge ‚≠ï‚ùå</div>
        <div class="ttt-grid">
            <div class="cell" onclick="playTTT(0)"></div><div class="cell" onclick="playTTT(1)"></div><div class="cell" onclick="playTTT(2)"></div>
            <div class="cell" onclick="playTTT(3)"></div><div class="cell" onclick="playTTT(4)"></div><div class="cell" onclick="playTTT(5)"></div>
            <div class="cell" onclick="playTTT(6)"></div><div class="cell" onclick="playTTT(7)"></div><div class="cell" onclick="playTTT(8)"></div>
        </div>
        <p style="margin-top:10px; font-size:0.8rem; color:#ff69b4;">You must win to earn the next level!</p>
    </section>

<section class="frame">

    <h2>Answer these correctly to move forward üí≠</h2>

    <p id="quizQuestion" style="font-size:1.2rem; margin-bottom:15px;"></p>

    <input 
        type="text"
        id="quizInput"
        placeholder="Type your answer..."
        style="
            padding:12px;
            width:80%;
            max-width:450px;
            border-radius:10px;
            border:1px solid #ccc;
            font-size:1rem;
        "
    >

    <br><br>

    <button id="quizSubmit">Submit</button>

    <p id="quizFeedback" style="margin-top:20px; min-height:30px;"></p>

</section>

<section class="frame">
    <div class="text">Piece Us Together üß©</div>
    <div class="puzzle-container" id="puzzleBoard">
        <div class="puzzle-slot" data-idx="0"></div>
        <div class="puzzle-slot" data-idx="1"></div>
        <div class="puzzle-slot" data-idx="2"></div>
        <div class="puzzle-slot" data-idx="3"></div>
        <div class="puzzle-slot" data-idx="4"></div>
        <div class="puzzle-slot" data-idx="5"></div>
        <div class="puzzle-slot" data-idx="6"></div>
        <div class="puzzle-slot" data-idx="7"></div>
        <div class="puzzle-slot" data-idx="8"></div>
    </div>
    <div class="pieces-bin" id="piecesBin"></div>
    <p id="puzzleHint" style="font-size: 0.8rem; color: #ff69b4; margin-top: 10px;">Drag the pieces to the board!</p>
    <button id="puzzleNext" class="btn-opt" style="width: 180px; display: none;" onclick="unlockNext()">Next</button>
</section>

    <section class="frame">

    <h2 id="flagRoundTitle"></h2>

    <p id="flagQuestion" style="font-size:1.2rem; margin:20px 0;"></p>

    <div style="display:flex; gap:20px; justify-content:center;">
        <button id="greenBtn" style="background:#4CAF50; color:white;">Green Flag üíö</button>
        <button id="redBtn" style="background:#e53935; color:white;">Red Flag üö©</button>
    </div>

    <div style="margin-top:25px; height:6px; background:#ddd; width:80%; margin-left:auto; margin-right:auto;">
        <div id="flagBar" style="height:6px; width:0%; background:#4CAF50;"></div>
    </div>
    </section>
    

    <section class="frame">
    <div class="text">Emoji Decode üíå</div>
    <div class="box">
        <div id="emojiDisplay" style="font-size:2.5rem; margin-bottom:15px; text-shadow: 0 0 10px #ff69b4;">‚úàÔ∏èüåçü´Ç‚ù§Ô∏è</div>
        <p id="emojiHint" style="font-size: 0.8rem; color: #ff69b4; margin-bottom: 15px;"></p>
        
        <div id="emojiOptions"></div>
        
        <p id="emojiResult" style="margin-top:10px; font-weight: bold;"></p>
    </div>
</section>

    <section class="frame">
        <div class="text">Plan our next date üçøüçú</div>
        <div class="box">
            <button class="btn-opt" onclick="saveDate()">Playing some online game üéÆ</button>
            <button class="btn-opt" onclick="saveDate()">Movie üé¨</button>
            <button class="btn-opt" onclick="saveDate()">Endless Video Call üìû</button>
            <p id="dateResult" style="margin-top:10px;color:#ff69b4"></p>
        </div>
    </section>

<section class="frame" style="background: #050714; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;">
    
    <div class="text" style="font-family: 'Great Vibes', cursive; color: #ff69b4; margin-bottom: 20px;">Rhymes for my Superstar üíå</div>

    <div style="position: relative; width: 100%; max-width: 400px; height: 350px; background: #fdf5e6; border-radius: 10px; box-shadow: inset 0 0 50px rgba(0,0,0,0.2), 10px 10px 30px rgba(0,0,0,0.5); overflow-y: auto; padding: 30px; border: 8px solid #3e2723; scrollbar-width: thin;">
        
        <div style="font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif, cursive; color: #3e2723; font-size: 1.4rem; line-height: 1.8; text-align: center;">
            <p style="margin-bottom: 40px;">The wheels on the bus go round and round,
To find where Frooti can be found!
From USA to India‚Äôs shore,
I love my Rockstar more and more! üöå</p>
            
            <p style="margin-bottom: 40px;">Frooti dil ki rani hai,
Jeevan uska pani hai!
Hath lagao toh muskurayegi,
Parlin bulao toh daudi aayegi! üëë</p>
            
            <p style="margin-bottom: 40px;">Pitter patter, pitter patter, rain is on the pane,
Calling Frooti's name again and again.
Barish aayi, cham-cham-cham,
Frooti meri, number one! üåßÔ∏è</p>
            
            <p style="margin-bottom: 40px;">Rain, rain, go away,
Come again another day.
Frooti Rockstar wants to play,
Across the ocean, far away!
Rain, rain, go to Spain,
Don't you bother Frooti's brain! üåßÔ∏è</p>
            
            <p style="margin-bottom: 40px;">Phalo ka raja Aam hai,
Par Frooti ka alag hi naam hai!
Meethi-meethi, pyari-pyari,
Sabse sundar, sabse nyari!
Vadodara ki shaan hai,
Meri toh ye jaan hai! ‚ù§Ô∏è</p>
            
            <div style="font-size: 2rem; margin-top: 20px;">üìú</div>
        </div>
    </div>

    <button class="btn-opt" style="margin-top: 30px; width: 220px; background: rgba(255,105,180,0.2); border: 2px solid #ff69b4;" onclick="unlockNext()">
        Keep Exploring ‚ù§Ô∏è
    </button>
</section>


    <section class="frame" id="pathFrame">
        <div class="text">Memory Lane ü§ç</div>
        <p style="font-size: 0.9rem; margin-bottom: 10px; opacity: 0.8;">Click all the intials to reveal some special message for each initial!</p>
        <div id="pathArea" style="position:relative; width:450px; height:450px;">
            <svg width="450" height="450"><path id="heartPath" class="path-line"></path></svg>
            <div id="heartInitialsWrapper">
    <div id="heartInitials">#SaRu Che</div>
</div>
        </div>
    </section>

    <section class="frame" style="background: #050714; justify-content: space-evenly;">
    <div class="text" style="font-family: 'Great Vibes', cursive; color: #ff69b4; margin-bottom: 10px;">
        The comparison that doesn't even make sense ü§¶‚Äç‚ôÇÔ∏è
    </div>
    
    <div class="box" style="max-width: 500px; max-height: 60vh; padding: 10px; border: 2px solid #ff69b4; background: rgba(255,105,180,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
        <img src="https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/ALOOVSFROOTO.png" 
             alt="Wifey vs Alia" 
             style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 15px; box-shadow: 0 0 20px rgba(255,105,180,0.5);">
    </div>

    <p style="margin-top: 15px; font-size: 1.1rem; font-style: italic; color: #ff69b4;">
        "I think we all know who the real winner is." üéÄ
    </p>
    
    <button class="btn-opt" style="margin-top: 10px; width: 220px;" onclick="unlockNext()">Absolutely! ‚ù§Ô∏è</button>
</section>

    <section class="frame">
    <div class="text">A Final Secret... üîí</div>
    
    <div id="password-area" style="margin-bottom: 20px;">
        <p style="font-size: 0.9rem; color: #ff69b4; margin-bottom: 10px;">Enter the secret code to read the letter:</p>
        <input type="password" id="giftPassword" placeholder="Hint: What comes after Uhn, Uhn, Uhn?" 
               style="padding: 15px; width: 90%; max-width: 400px; border-radius: 25px; border: 2px solid #ff69b4; background: transparent; color: #fff; text-align: center; outline: none; margin-bottom: 10px;">
        <br>
        <button class="btn-opt" style="width: 150px; font-size: 0.7rem; display: inline-block; margin-right: 5px;" onclick="handleGiftClick(true)">Unlock Letter</button>
        <button class="btn-opt" style="width: 150px; font-size: 0.7rem; display: inline-block; opacity: 0.6;" onclick="handleGiftClick(false)">Guest Mode (No Letter)</button>
    </div>

    <div class="gift-container" id="gift">
        <div class="gift-lid"></div>
        <div class="gift-box"></div>
        <div class="reveal-gift">
            Happy Birthday <br> FROOTO üíû
        </div>
    </div>
</section>
</div>

<div id="end-screen">
    <div class="text" style="font-size: 4rem; color: #ff69b4;">The End</div>
    <h2 id="thankYouTitle">Thank You for Playing üíñ</h2>
<p id="thankYouMessage">
    I hope you enjoyed this little experience I made for you.
</p>
    <button class="btn-opt" style="width: 200px; margin-top: 50px;" onclick="location.reload()">Replay Quest üîÑ</button>
</div>

<div class="modal" id="modal">
    <div id="modalBox" style="background:#0b1023; padding:40px; border-radius:20px; border:2px solid #ff69b4; text-align:center;">
        <div id="photoContent"></div>
        <p id="modalMsg"></p><br>
        <button id="modalBtn" onclick="closeModal()" style="color:#ff69b4; background:none; border:none; cursor:pointer; font-weight:bold;">Close</button>
    </div>
</div>

<script>
    const bgm = document.getElementById('bgm');
    const reel = document.getElementById('reel');
    const meter = document.getElementById('loveMeter');
    let canScroll = false;
    let currentLevel = 0;
    let lastTrailTime = 0;

    // Photo Array
    const heartPhotos = [
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/R.png", msg: "R"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/U.png", msg: "U"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/D.png", msg: "D"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/U2.png", msg: "U"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/L.png", msg: "L"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/O.png", msg: "O"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/V.png", msg: "V"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/E.png", msg: "E"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/S.png", msg: "S"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/F.png", msg: "F"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/R2.png", msg: "R"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/O2.png", msg: "O"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/O3.png", msg: "O"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/T.png", msg: "T"},
        { url: "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/O4.png", msg: "Forever locked into this moment‚ù§Ô∏è" }
    ];

    // Trail
    document.addEventListener('mousemove', (e) => {
        const now = Date.now();
        if (now - lastTrailTime < 60) return;
        lastTrailTime = now;
        const t = document.createElement('div');
        t.className = 'trail';
        t.innerText = Math.random() > 0.5 ? 'üêò' : 'üíñ';
        t.style.left = e.clientX + 'px'; t.style.top = e.clientY + 'px';
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 2500);
    });

    document.body.addEventListener('click',()=>bgm.play().catch(()=>{}),{once:true});

    // SCROLL LOCKING
    reel.addEventListener('scroll', (e) => {
        if (!canScroll) {
            reel.scrollTop = currentLevel * window.innerHeight;
        }
    });


    // end screen name atttachment
    function personalizeThankYou() {
    const name = n();

    const title = document.getElementById("thankYouTitle");
    const message = document.getElementById("thankYouMessage");

    if (title) {
        title.innerText = `Thank You for Playing, ${name} üíñ`;
    }

    if (message) {
        message.innerText =
            `I hope you enjoyed every section of this little world and it made you feel special and loved.`;
    }
}


    // Unlock Next Logic
    function unlockNext() {
        canScroll = true;
        // Fix: Update stamp based on level being unlocked
        const stamp = document.getElementById(`stamp-${currentLevel}`);
        if(stamp) stamp.classList.add('unlocked');
        
        currentLevel++;
        reel.style.overflowY = "scroll";
        reel.scrollTo({ top: currentLevel * window.innerHeight, behavior: 'smooth' });
        
        setTimeout(() => {
            reel.style.overflowY = "hidden";
            canScroll = false;
        }, 1200);
        if (currentSection === 3) {
    animateStickyNotes();
    initFinishSentence();
}
    }

    function startQuest() {
    const music = document.getElementById('bgm');
    
    // Force volume to 100% just in case
    music.volume = 1.0; 

    // Trigger play
    const playPromise = music.play();

    if (playPromise !== undefined) {
        playPromise.then(() => {
            console.log("Playback started!");
        }).catch(error => {
            console.log("Playback failed: ", error);
            // Fallback: alert the user they need to click once more
            alert("Please click 'OK' to start the music!");
            music.play();
        });
    }

    // This moves to the next slide regardless of audio success
    unlockNext();
}

    // TYPEWRITER
    const intro = "SANJARI DAY ü©∑ü§çüíú MARCH 1ST 2026 üéÇüéÅü•≥ READY FOR DEPARTURE? ‚úàÔ∏è";
    let cIdx = 0; function type() { if(cIdx < intro.length){ document.getElementById("typewriter").innerHTML += intro.charAt(cIdx++); setTimeout(type, 100); } }
    window.onload = type;

    // CLOCKS
    setInterval(() => {
        const now = new Date();
        document.getElementById('myTime').innerText = now.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit', timeZone:'America/New_York'});
        document.getElementById('herTime').innerText = now.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit', timeZone:'Asia/Kolkata'});
    }, 1000);

    // FLIGHT

    // NEW FLIGHT ANIMATION WITH FUEL METER

let flightProgress = 0;

function boostPlane() {
    const plane = document.getElementById('interactive-plane');
    const status = document.getElementById('flight-status');
    const btn = document.getElementById('boost-btn');
    const assets = document.getElementById('flight-assets');
    const photo = document.getElementById('arrival-photo');

    flightProgress = Math.min(100, flightProgress + 10);
    plane.style.offsetDistance = flightProgress + "%";

    if (flightProgress < 100) {
        status.innerText = `Distance Covered: ${flightProgress}%`;
    } else {
        // Hide game assets
        assets.style.display = 'none';
        
        // Reveal photo and message together
        photo.style.display = 'block';
        setTimeout(() => { 
            photo.style.opacity = "1"; 
        }, 50);

        status.innerHTML = "Landed in your heart! ‚ù§Ô∏è";
        btn.innerText = "Begin the Memories";
        btn.onclick = unlockNext; // Moves to the Dynamic Quiz
        updateMeter(15);
    }
}


    let notesRevealed = 0;

function revealNote(element, message) {
    if (!element.classList.contains('revealed')) {
        element.innerText = message;
        element.classList.add('revealed');
        notesRevealed++;
        
        // When all 4 notes are read
        if (notesRevealed === 10) {
            updateMeter(65);
            document.getElementById('reasonsNextBtn').style.display = 'block';
        }
    }
}

function animateStickyNotes() {
    const notes = document.querySelectorAll(".sticky");

    notes.forEach((note, index) => {
        setTimeout(() => {
            note.classList.add("drop");
        }, index * 200);
    });
}


    // Updated Flight Animation
function startFlight() {
    const p = document.getElementById('plane-icon');
    const s = document.getElementById('wish-status');
    const msgDiv = document.getElementById('sky-message');
    const path = document.getElementById('flight-path');
    
    document.getElementById('start-btn').style.display = 'none';
    p.style.display = 'block';
    
    // Set the plane to follow the arc path
    p.style.offsetPath = `path('${path.getAttribute('d')}')`;
    
    s.innerText = "Sending love across the ocean... ‚úàÔ∏è";
    
    // 1. Move the plane along the path
    const planeAnim = p.animate([
        { offsetDistance: "0%" },
        { offsetDistance: "100%" }
    ], { 
        duration: 4000, 
        easing: 'ease-in-out', 
        fill: 'forwards' 
    });

    // 2. Reveal the plain text once the plane finishes its journey
    planeAnim.onfinish = () => {
        s.innerText = "Arrived in Vadodara! üíñ";
        msgDiv.style.opacity = "1"; // Fades the text in
        
        updateMeter(15); 
        setTimeout(unlockNext, 2500); 
    };
}

let starsLit = 0;
let lastStar = null;

function lightStar(el, msg) {
    if (el.classList.contains('active')) return;
    
    el.classList.add('active');
    document.getElementById('star-msg').innerText = msg;
    
    const container = document.getElementById('sky-container').getBoundingClientRect();
    const rect = el.getBoundingClientRect();
    const x = rect.left - container.left + 6;
    const y = rect.top - container.top + 6;

    if (lastStar) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", lastStar.x);
        line.setAttribute("y1", lastStar.y);
        line.setAttribute("x2", x);
        line.setAttribute("y2", y);
        document.getElementById('star-lines').appendChild(line);
    }

    lastStar = {x, y};
    starsLit++;

    if (starsLit === 4) {
        setTimeout(() => {
            document.getElementById('star-msg').innerText = "Our love is a galaxy. ‚ù§Ô∏è";
            document.getElementById('starNextBtn').style.display = 'block';
            updateMeter(55); 
        }, 1000);
    }
}


    // QUIZ
    //const qData = [{q:"Which platform did we first speak on?", a:["Instagram","WhatsApp", "Snapchat", "Linkedin"], c:1}, {q:"My favorite memory?", a:["Wedding Day","Madhuban Resort","Kerala Trip","Everything"], c:1}];
    // Dynamic Quiz Data
    const qData = [
    {
        q: "Which platform did we first speak on?", 
        a: ["Instagram", "WhatsApp", "Snapchat", "Linkedin"], 
        correct: "WhatsApp" // Set the specific string as the answer
    }, 
    {
        q: "What is my first gift to you?",
        a: ["Photo Magnet", "Chocolate Bar", "Hair Bow", "Watch"],
        correct: "Hair Bow"
    },
    {
        q: "Our First Date?", 
        a: ["Earthmonk Cafe", "Brewery", "Madhuban Resort", "Car Drive to VVN"], 
        correct: "Brewery"
    },
    {
        q: "My Favorite Memory?", 
        a: ["Madhuban Resort", "Kerala Trip", "Wedding Day", "Guess what - all of these and more"], 
        correct: "Guess what - all of these and more"
    },
];
    
    let curQ = 0;
    function loadQuiz() {
    const d = qData[curQ]; 
    const quizOptions = document.getElementById('quizOptions');
    const qText = document.getElementById('qText');
    
    qText.innerText = d.q;
    quizOptions.innerHTML = ""; // Clear old buttons
    
    d.a.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn-opt';
        btn.innerText = opt;
        // This ensures the exact text is passed to the checker
        btn.onclick = () => checkQuiz(opt); 
        quizOptions.appendChild(btn);
    });
    }
    function checkQuiz(selectedText) {
    const currentQuestion = qData[curQ];
    
    console.log("Selected:", selectedText, "Correct:", currentQuestion.correct);

    if (selectedText === currentQuestion.correct) { 
        curQ++; 
        if (curQ < qData.length) { 
            reveal("Correct! ‚ù§Ô∏è", false); 
            loadQuiz(); 
        } 
        else { 
            updateMeter(30); 
            reveal("Quiz Complete! Unlocking next level... ‚úàÔ∏è", true); 
        } 
    } else { 
        alert("Not quite! Try to remember..."); 
    }
    }
    loadQuiz();

    function n() {
    const input = document.getElementById("nameInput");
    return input && input.value.trim() ? input.value.trim() : "you";
}

    // SCRATCH
    // SCRATCH (FIXED)
let scratches = 0;

document.querySelectorAll('.scratch-canvas').forEach((cvs) => {
    const ctx = cvs.getContext('2d');
    ctx.fillStyle = '#888';
    ctx.fillRect(0,0,130,130);
    ctx.globalCompositeOperation = 'destination-out';

    let scratched = false;

    const scratchFunc = (e) => {
        if(!scratched){
            scratched = true;
            scratches++;

            if(scratches === 3){
    setTimeout(() => {
        document.querySelectorAll('.scratch-canvas').forEach(c => {
            c.style.transition = "opacity 1.2s";
            c.style.opacity = 0.15;
        });

        document.getElementById('scratch-hint').innerText =
            `Hope you're enjoying the game!!, ${n()} üíå`;

        document.getElementById('scratch-unlock-btn').style.display = 'block';
    }, 800);
}
        }

        const r = cvs.getBoundingClientRect();
        const x = (e.clientX || e.touches?.[0].clientX) - r.left;
        const y = (e.clientY || e.touches?.[0].clientY) - r.top;
        ctx.beginPath();
        ctx.arc(x, y, 18, 0, Math.PI*2);
        ctx.fill();
    };

    cvs.addEventListener('mousemove', scratchFunc);
    cvs.addEventListener('touchmove', scratchFunc);
});

    // TTT
    let bt = ["","","","","","","","",""];
    function playTTT(i) {
        if(bt[i]==="") {
            bt[i]="üíú"; document.getElementsByClassName('cell')[i].innerText="üíú";
            if(checkW("üíú")) { updateMeter(75); reveal("You won! You've earned the next level. ‚ù§Ô∏è", true); return; }
            if(bt.filter(v=>v==="").length === 0) { alert("Tie! Resetting..."); resetTTT(); return; }
            setTimeout(() => { 
                let e = bt.map((v,idx)=>v===""?idx:null).filter(v=>v!==null); 
                if(e.length){ 
                    let m=e[Math.floor(Math.random()*e.length)]; 
                    bt[m]="‚ùå"; document.getElementsByClassName('cell')[m].innerText="‚ùå"; 
                    if(checkW("‚ùå")) { alert("I won! Restarting..."); resetTTT(); }
                } 
            }, 300);
        }
    }
    function resetTTT() { bt = ["","","","","","","","",""]; Array.from(document.getElementsByClassName('cell')).forEach(c => c.innerText = ""); }
    function checkW(p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(s => s.every(i => bt[i] === p)); }



    // PUZZLE LOGIC
const imageUrl = "https://raw.githubusercontent.com/ruddy220497/Birthday/refs/heads/main/VIP00217.jpg"; // Replace with your photo
const piecesBin = document.getElementById('piecesBin');
const boardSlots = document.querySelectorAll('.puzzle-slot');
let matchedPieces = 0;

function initPuzzle() {
    const indices = [0, 1, 2, 3, 4, 5, 6, 7, 8];
    const shuffled = indices.sort(() => Math.random() - 0.5);

    shuffled.forEach(i => {
        const piece = document.createElement('div');
        piece.className = 'puzzle-piece';
        piece.style.backgroundImage = `url(${imageUrl})`;
        
        // Calculate background position for the 3x3 grid
        const x = (i % 3) * 80;
        const y = Math.floor(i / 3) * 80;
        piece.style.backgroundPosition = `-${x}px -${y}px`;
        piece.setAttribute('data-correct', i);
        
        // Add dragging listeners
        piece.onmousedown = startDrag;
        piece.ontouchstart = startDrag;
        
        piecesBin.appendChild(piece);
    });
}

function startDrag(e) {
    const piece = e.target;
    const isTouch = e.type === 'touchstart';
    const moveEvent = isTouch ? 'touchmove' : 'mousemove';
    const upEvent = isTouch ? 'touchend' : 'mouseup';
    
    piece.style.zIndex = 1000;
    
    function move(ev) {
        const x = (isTouch ? ev.touches[0].clientX : ev.clientX) - 40;
        const y = (isTouch ? ev.touches[0].clientY : ev.clientY) - 40;
        piece.style.left = x + 'px';
        piece.style.top = y + 'px';
        piece.style.position = 'fixed';
    }

    function drop(ev) {
        document.removeEventListener(moveEvent, move);
        document.removeEventListener(upEvent, drop);
        
        const clientX = isTouch ? ev.changedTouches[0].clientX : ev.clientX;
        const clientY = isTouch ? ev.changedTouches[0].clientY : ev.clientY;
        
        piece.style.display = 'none';
        const elementBelow = document.elementFromPoint(clientX, clientY);
        piece.style.display = 'block';

        if (elementBelow && elementBelow.classList.contains('puzzle-slot')) {
            const slotIdx = elementBelow.getAttribute('data-idx');
            const correctIdx = piece.getAttribute('data-correct');

            if (slotIdx === correctIdx) {
                // Snap to position
                elementBelow.appendChild(piece);
                piece.style.position = 'relative';
                piece.style.left = '0';
                piece.style.top = '0';
                piece.style.cursor = 'default';
                piece.onmousedown = null;
                piece.ontouchstart = null;
                matchedPieces++;

                // Inside your drop function, where you check if matchedPieces === 9
// Inside your drop function
if (matchedPieces === 9) {
    const board = document.getElementById('puzzleBoard');
    
    // This triggers the expansion and the removal of grid lines
    board.classList.add('completed');
    
    document.getElementById('puzzleHint').innerText = "Look how perfect we are! ‚ù§Ô∏è";
    
    // Hide the pieces bin to keep the screen clean during expansion
    document.getElementById('piecesBin').style.opacity = '0';

    setTimeout(() => {
        document.getElementById('puzzleNext').style.display = 'block';
    }, 1000); // Wait for the expansion to finish
    
    updateMeter(75);
}
            }
        }
    }

    document.addEventListener(moveEvent, move);
    document.addEventListener(upEvent, drop);
}

// Call this inside window.onload
initPuzzle();
    
    // HEART PATH
    function hXY(t, s=14, oX=225, oY=210){ return { x: s*16*Math.pow(Math.sin(t),3)+oX, y: -s*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))+oY }; }
    let pathD = ""; for(let i=0; i<=6.28; i+=0.1){ let {x,y} = hXY(i); pathD += (i===0?"M":"L")+x+" "+y+" "; }
    document.getElementById('heartPath').setAttribute("d", pathD);



    // Add this list of names
    const dotNames = ["R", "U", "D", "U", "L", "O", "V", "E", "S", "F", "R", "O", "O", "T", "0"];

    // Updated for exactly 15 dots with clean spacing
let viewedPhotos = new Array(15).fill(false);
let dotsFound = 0;

for(let k=0; k<15; k++){
    // 6.0 creates a gap at the top so dot 1 and 15 don't touch
    let t = (k / 16) * 6.2; 
    
    // Spacing adjustment for the bottom tip (around dots 7 and 8)
    if(k > 7) t += 0.08;

    let {x, y} = hXY(t); 
    let s = document.createElement('div'); 
    s.className = 'step'; 
    s.style.left = (x - 13) + 'px'; 
    s.style.top = (y - 13) + 'px'; 
    s.innerText = dotNames[k]; 

    s.onclick = () => { 
        showHeartPhoto(k);
        s.style.display = "none"; // Dot disappears when clicked
        viewedPhotos[k] = true;
        dotsFound++;
        
        if(dotsFound === 15) {
            window.lastHeartClick = true; // Signals the finale
        }
    };
    document.getElementById('pathArea').appendChild(s);
}
    
    

    function showHeartPhoto(idx) {
        const photo = heartPhotos[idx];
        document.getElementById('photoContent').innerHTML = `<img src="${photo.url}" class="photo-modal-img">`;
        document.getElementById('modalMsg').innerText = photo.msg;
        document.getElementById('modalBtn').onclick = closeModal; // Ensure it just closes
        document.getElementById('modal').style.display = 'flex';
        sn = false; // Prevent auto-scroll
    }

    function finishHeart() {
    const hp = document.getElementById('heartPath');
    const initials = document.getElementById('heartInitials');

    // Reveal heart
    hp.style.opacity = "1";
    hp.style.fill = "rgba(255, 105, 180, 0.35)";

    // Glow & pulse
    hp.classList.add("heart-glow");
    hp.classList.add("heart-pulse");

    initials.style.opacity = "1";
    initials.style.textShadow = "0 0 25px #ff69b4";
    document.getElementById("heartInitials").classList.add("heart-pulse");

    // Remove dots
    document.querySelectorAll('.step').forEach(step => step.style.display = 'none');

    updateMeter(90);

    // Hold the moment, then continue
    setTimeout(unlockNext, 3000);
}

let beatCount = 0;

function pulseHeart() {
    const heart = document.getElementById('tap-heart');
    const status = document.getElementById('tap-status');
    const msg = document.getElementById('tap-message');
    const nextBtn = document.getElementById('tapNextBtn');

    if (beatCount < 10) {
        beatCount++;
        
        // Visual Thump
        heart.style.transform = "scale(1.3)";
        setTimeout(() => { heart.style.transform = "scale(1)"; }, 100);
        
        status.innerText = `BEATS SENT: ${beatCount}/10`;

        if (beatCount === 10) {
            status.innerText = "HEARTS SYNCED!";
            status.style.color = "#a9ff68";
            
            // Reveal Message
            msg.innerText = "Every beat of our heart carries a message across the ocean: I love you (sea)much. üåä‚ù§Ô∏è";
            msg.style.opacity = "1";
            
            nextBtn.style.display = 'block';
            updateMeter(55);
        }
    }
}
    // ===== Finish The Sentence Section =====

// ===== Progressive Question Game =====

const quizData = [
    {
        question: "Twinkle Twinkle?",
        answer: "Little star"   // change to your real answer
    },
    {
        question: "Frooti is a?",
        answer: "Superstar"  // change this
    },
    {
        question: "Up above the world so high, Frooti is the?",
        answer: "Apple of my eye"     // change this
    }
];

let currentQuestion = 0;

function initQuizGame() {

    const questionEl = document.getElementById("quizQuestion");
    const inputEl = document.getElementById("quizInput");
    const submitBtn = document.getElementById("quizSubmit");
    const feedbackEl = document.getElementById("quizFeedback");

    if (!questionEl || !inputEl || !submitBtn || !feedbackEl) return;

    function loadQuestion() {
        questionEl.innerText = quizData[currentQuestion].question;
        inputEl.value = "";
        feedbackEl.innerText = "";
    }

    function checkAnswer() {
        const userAnswer = inputEl.value.trim().toLowerCase();
        const correctAnswer = quizData[currentQuestion].answer.toLowerCase();

        if (userAnswer === correctAnswer) {

            feedbackEl.innerText = `Correct ‚úÖ`;

            currentQuestion++;

            if (currentQuestion < quizData.length) {
                setTimeout(loadQuestion, 1200);
            } else {

                feedbackEl.innerText = 
                    `You got them all right üëè`;

                updateMeter(70); // adjust if needed

                setTimeout(() => {
                    unlockNext();
                }, 2000);
            }

        } else {
            feedbackEl.innerText = "Hmm‚Ä¶ try again üòå";
        }
    }

    submitBtn.onclick = checkAnswer;

    inputEl.addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            checkAnswer();
        }
    });

    loadQuestion();
}

// Initialize when page loads
document.addEventListener("DOMContentLoaded", initQuizGame);


function popNote(element) {
    element.classList.toggle('popped');
    // Optional: Add a small sound or haptic feedback here
}


// ===== Clean Layered Red / Green Flag Game =====

const flagRounds = [
  {
    title: "Round 1 ‚Äî Cute Things üòå",
    questions: [
      { text: "He sends good morning texts every day", correct: "green" },
      { text: "He steals your fries", correct: "green" },
      { text: "He double texts when he misses you", correct: "green" },
      { text: "He leaves you on read for 6 hours", correct: "red" },
      { text: "He remembers small details about you", correct: "green" }
    ]
  },
  {
    title: "Round 2 ‚Äî Relationship Depth üí¨",
    questions: [
      { text: "He communicates when upset", correct: "green" },
      { text: "He avoids difficult conversations", correct: "red" },
      { text: "He respects your independence", correct: "green" },
      { text: "He invalidates your feelings", correct: "red" },
      { text: "He listens to understand, not to win", correct: "green" }
    ]
  },
  {
    title: "Round 3 ‚Äî Long Distance üíå",
    questions: [
      { text: "He books tickets instead of saying 'soon'", correct: "green" },
      { text: "He makes time even on busy days", correct: "green" },
      { text: "He avoids talking about the future", correct: "red" },
      { text: `He reminds ${n()} how loved you are`, correct: "green" },
      { text: "He puts effort into closing the distance", correct: "green" }
    ]
  }
];

let currentRound = 0;
let currentQuestion1 = 0;
let flagScore = 0;

const totalQuestions = flagRounds.reduce((sum, r) => sum + r.questions.length, 0);
let answered = 0;

function initFlagGame() {

  const roundTitle = document.getElementById("flagRoundTitle");
  const questionEl = document.getElementById("flagQuestion");
  const greenBtn = document.getElementById("greenBtn");
  const redBtn = document.getElementById("redBtn");
  const flagBar = document.getElementById("flagBar");

  if (!roundTitle) return;

  function loadQuestion() {
    const round = flagRounds[currentRound];
    const question = round.questions[currentQuestion1];

    roundTitle.innerText = round.title;
    questionEl.innerText = question.text;
  }

  function handleAnswer(choice) {

    const round = flagRounds[currentRound];
    const question = round.questions[currentQuestion1];

    if (choice === question.correct) {
      flagScore++;
    }

    answered++;
    flagBar.style.width = (answered / totalQuestions) * 100 + "%";

    currentQuestion1++;

    if (currentQuestion1 >= round.questions.length) {
      currentRound++;
      currentQuestion1 = 0;
    }

    if (currentRound >= flagRounds.length) {
      showResult();
    } else {
      loadQuestion();
    }
  }

  function showResult() {

    roundTitle.innerText = "Final Result üíñ";

    if (flagScore >= 12) {
      questionEl.innerText =
        `We are literally the greenest flag relationship ever, ${n()} üíö`;
    } 
    else if (flagScore >= 8) {
      questionEl.innerText =
        `Okay‚Ä¶ mostly green with a little chaos üòå`;
    } 
    else {
      questionEl.innerText =
        `We might need a relationship workshop üò≠`;
    }

    updateMeter(60); // adjust if needed

    setTimeout(() => {
      unlockNext();
    }, 2500);
  }

  greenBtn.onclick = () => handleAnswer("green");
  redBtn.onclick = () => handleAnswer("red");

  loadQuestion();
}

document.addEventListener("DOMContentLoaded", initFlagGame);

const emojiLevels = [
    {
        emojis: "üåç ‚û°Ô∏è üìç ‚ù§Ô∏è",
        hint: "Layer 1: The Geography",
        options: [
            "Traveling the whole world", 
            "The entire world is just wherever you are", 
            "Finding a location on a map"
        ],
        correct: "The entire world is just wherever you are"
    },
    {
        emojis: "üì± üï∞Ô∏è üò¥ üö´",
        hint: "Layer 2: The Routine",
        options: [
            "My phone is broken at night", 
            "Setting an alarm for the morning", 
            "Sacrificing sleep just to hear your voice"
        ],
        correct: "Sacrificing sleep just to hear your voice"
    },
    {
        emojis: "üîí üóùÔ∏è üßø ü´Ç",
        hint: "Layer 3: The Protection",
        options: [
            "Protecting our bond from every evil eye", 
            "Locking the door before sleeping", 
            "Buying a new necklace for you"
        ],
        correct: "Protecting our bond from every evil eye"
    },
    {
        emojis: "üåä ü´Ç ‚òï ‚ùÑÔ∏è",
        hint: "Layer 4: The Comfort",
        options: [
            "Going to the beach for coffee", 
            "Winter is very cold this year", 
            "Being with you feels like a warm cup of coffee on a cold day"
        ],
        correct: "Being with you feels like a warm cup of coffee on a cold day"
    },
    {
        emojis: "üíç ‚ú® ‚ôæÔ∏è üïäÔ∏è",
        hint: "Final Layer: The Promise",
        options: [
            "Our love is the only thing that is permanent", 
            "Buying expensive jewelry", 
            "A bird flying with a ring"
        ],
        correct: "Our love is the only thing that is permanent"
    }
];

let currentEmojiLayer = 0;

function initEmojiGame() {
    const display = document.getElementById('emojiDisplay');
    const hint = document.getElementById('emojiHint');
    const optionsContainer = document.getElementById('emojiOptions');
    const feedback = document.getElementById('emojiResult'); // Using your existing ID

    if (!display || !optionsContainer) return;

    const data = emojiLevels[currentEmojiLayer];
    
    display.innerText = data.emojis;
    hint.innerText = `${data.hint} (${currentEmojiLayer + 1}/5)`;
    optionsContainer.innerHTML = "";
    feedback.innerText = "";

    data.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn-opt';
        btn.innerText = opt;
        btn.onclick = () => checkEmojiDecode(opt);
        optionsContainer.appendChild(btn);
    });
}

function checkEmojiDecode(choice) {
    const feedback = document.getElementById('emojiResult');
    const correct = emojiLevels[currentEmojiLayer].correct;

    if (choice === correct) {
        currentEmojiLayer++;
        feedback.style.color = "#a9ff68";
        feedback.innerText = "Access Granted... üîì";
        
        if (currentEmojiLayer < emojiLevels.length) {
            setTimeout(initEmojiGame, 1000);
        } else {
            feedback.innerText = "All layers decoded! You know me so well. ‚ù§Ô∏è";
            updateMeter(85); 
            setTimeout(unlockNext, 2000);
        }
    } else {
        feedback.style.color = "#ff4d4d";
        feedback.innerText = "Incorrect Cipher. Try again... ‚ùå";
    }
}

// Add to your DOMContentLoaded listener
document.addEventListener("DOMContentLoaded", () => {
    initEmojiGame();
});

    // MODAL HELPERS
    let sn = false;
    function reveal(m, s) { 
        document.getElementById('photoContent').innerHTML = ""; 
        document.getElementById('modalMsg').innerText = m; 
        document.getElementById('modal').style.display = 'flex'; 
        sn = s; 
        document.getElementById('modalBtn').onclick = () => { 
            document.getElementById('modal').style.display = 'none'; 
            if(sn) unlockNext(); 
        };
    }
    function closeModal() { 
    document.getElementById('modal').style.display = 'none';

    // ‚úÖ If last heart memory was clicked, finish path properly
    if (window.lastHeartClick) {
        window.lastHeartClick = false;
        setTimeout(finishHeart, 600);
    }
}
    function updateMeter(v) { meter.style.width = v + '%'; }

    function handleGiftClick(isSecretAttempt) {
    const passInput = document.getElementById('giftPassword').value.trim().toLowerCase();
    const correctPass = "1234?"; // Your secret code

    if (isSecretAttempt && passInput === correctPass) {
        // Path A: The Private Letter
        alert("Access Granted. Opening your letter now... ‚ù§Ô∏è");
        document.getElementById('password-area').style.display = "none";
        unwrap(true); 
    } else if (isSecretAttempt && passInput !== correctPass) {
        // Path B: Wrong Password -> Move forward anyway but hide letter
        alert("That code is just for Frooti! But you can still finish the journey. ‚ú®");
        document.getElementById('password-area').style.display = "none";
        unwrap(false);
    } else {
        // Path C: Guest Mode
        document.getElementById('password-area').style.display = "none";
        unwrap(false);
    }
}

function handleGiftClick(isSecretAttempt) {
    // .replace(/\s+/g, ' ') ensures multiple spaces count as one
    const passInput = document.getElementById('giftPassword').value.trim().toLowerCase().replace(/\s+/g, ' ');
    
    // This is exactly what she must type (case doesn't matter)
    const correctPass = "kab aaoge?"; 

    if (isSecretAttempt && passInput === correctPass) {
        // SUCCESS: Open the letter
        window.open('https://github.com/ruddy220497/Birthday/blob/main/Handwritten%20Birthday%20Letter.pdf', '_blank');
        
        document.getElementById('password-area').style.display = "none";
        // Call unwrap(false) so it doesn't try to open the letter a second time
        unwrap(false); 
    } else {
        // FAIL: Wrong password or Guest Mode
        alert("That code is just for Frooti! But you can still finish the journey. ‚ú®");
        document.getElementById('password-area').style.display = "none";
        unwrap(false);
    }
}
    
function unwrap(showLetter) { 
    // Start the animation by adding the 'unwrapped' class
    const gift = document.getElementById('gift');
    if (gift) gift.classList.add('unwrapped'); 

    // Complete the love meter and light the final stamp
    updateMeter(100); 
    const finalStamp = document.getElementById('stamp-15');
    if (finalStamp) finalStamp.classList.add('unlocked'); 

    // If the letter wasn't opened yet, open it after the animation
    if (showLetter) {
        setTimeout(() => {
            window.open('https://github.com/ruddy220497/Birthday/blob/main/Handwritten%20Birthday%20Letter.pdf', '_blank');
        }, 1500);
    }

    // Trigger the final End Screen
    setTimeout(() => { 
        const end = document.getElementById('end-screen'); 
        if (end) {
            end.style.display = 'flex'; 
            // Small delay to ensure display:flex is rendered
            setTimeout(() => {
                end.style.opacity = "1";
            }, 100); 
            personalizeThankYou();
        }
    }, 4500); 
}

    function genReason() { const reasons = ["Your heart.", "The way you care.", "Your contagious laugh.", "Everything about you.", "Your Kind Soul", "Inner child that lives in you"]; document.getElementById('reasonDisplay').innerText = reasons[Math.floor(Math.random()*reasons.length)]; }
    function finishSentence(){ document.getElementById("sentenceResult").innerText = "That‚Äôs when I fall for you all over again."; updateMeter(5); setTimeout(unlockNext, 1200); }
    let dist = 12000; function shrinkDistance(){ dist -= 4000; document.getElementById("distanceText").innerText = dist <= 0 ? "0 km. I‚Äôm right here ‚ù§Ô∏è" : dist + " km apart"; updateMeter(5); if(dist <= 0) setTimeout(unlockNext, 1200); }
    function flagChoice(){ document.getElementById("flagResult").innerText = "Correct. I love everything about you."; updateMeter(5); setTimeout(unlockNext, 1200); }
    function decodeEmoji(){ document.getElementById("emojiResult").innerText = "No matter the distance, I just want to hold you."; updateMeter(5); setTimeout(unlockNext, 1200); }
    function saveDate(){ document.getElementById("dateResult").innerText = "Saved. We‚Äôre doing this soon üíñ"; updateMeter(10); setTimeout(unlockNext, 1200); }
    function saveName(){ unlockNext(); }
    function n() {
    const input = document.getElementById("nameInput");
    return input && input.value.trim() ? input.value.trim() : "you";
}

/* MOBILE POLISH */
document.addEventListener("touchmove", e => {
    if(!canScroll) e.preventDefault();
}, { passive:false });

document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("touchstart", () => btn.classList.add("active"));
    btn.addEventListener("touchend", () => btn.classList.remove("active"));
});



</script>
</body>
</html>